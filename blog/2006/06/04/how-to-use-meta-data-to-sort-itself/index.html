<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width">

  <title>
    
      How to use meta-data to sort itself &middot; Baron Schwartz&#39;s Blog
    
  </title>

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  
  <meta name="og:title" content="How to use meta-data to sort itself" />
  <meta name="og:type" content="article" />
  <meta name="og:image" content="https://www.xaprb.com/" />
  <meta name="og:description" content="" />
  <meta name="og:url" content="https://www.xaprb.com/blog/2006/06/04/how-to-use-meta-data-to-sort-itself/" />
  <meta name="og:site_name" content="Baron Schwartz&#39;s Blog" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@xaprb" />

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/index.xml">

  
  <link rel="canonical" href="https://www.xaprb.com/blog/2006/06/04/how-to-use-meta-data-to-sort-itself/">
  

  <script type="text/javascript" src='//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
</head>


  <body class="layout-reverse sidebar-overlay">

    
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
	  <p>Baron Schwartz&#39;s Blog &middot; Stay Curious!</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>
    <a class="sidebar-nav-item" href="/blog/">Posts</a>
    
        <a class="sidebar-nav-item" href="/about/">About Baron Schwartz</a>
    
        <a class="sidebar-nav-item" href="/essential-books/">Essential Books</a>
    
        <a class="sidebar-nav-item" href="/rx-toolkit/">Regex Toolkit</a>
    
        <a class="sidebar-nav-item" href="/blog/2013/12/18/secure-your-accounts-and-devices/">Staying Secure Online</a>
    
        <a class="sidebar-nav-item" href="/blog/2013/07/10/ultimate-notebook-and-journal-face-off/">The Ultimate Notebook</a>
    
        <a class="sidebar-nav-item" href="/blog/2015/03/07/ultimate-pen-marker-face-off/">The Ultimate Pen</a>
    
  </nav>

  <div class="sidebar-item">
	  <p>&copy; 2016 Baron Schwartz.
	  <br><a href="/index.xml">RSS Feed</a>, <a href="/about/">Contact</a>.<br>
	 <br>Powered by <a href="http://hugo.spf13.com">Hugo</a>,
	  <a href="https://www.netlify.com/">Netlify</a>,
	  <a href="https://forestry.io/">Forestry</a>,
	  <a href="https://github.com/xaprb/xaprb-src/">GitHub</a>,
	  <a href="https://disqus.com">Disqus</a>,
	  <a href="https://swiftype.com/">Swiftype</a>.
	</p>
  </div>
</div>


    
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Baron Schwartz&#39;s Blog</a>
          </h3>
        </div>
      </div>

      <div class="container content">


<div class="post">
  <h1 class="post-title">How to use meta-data to sort itself</h1>
  <span class="post-date">Sun, Jun 4, 2006 in
		
		<a href="/categories/databases" class="btn btn-primary">Databases</a>
		
		<span class="share-buttons">
	<a href="https://twitter.com/intent/tweet?source=https%3a%2f%2fwww.xaprb.com%2fblog%2f2006%2f06%2f04%2fhow-to-use-meta-data-to-sort-itself%2f&text=How%20to%20use%20meta-data%20to%20sort%20itself:https%3a%2f%2fwww.xaprb.com%2fblog%2f2006%2f06%2f04%2fhow-to-use-meta-data-to-sort-itself%2f" target="_blank" title="Tweet"><i class="fa fa-twitter-square fa-lg"></i></a>
	<a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.xaprb.com%2fblog%2f2006%2f06%2f04%2fhow-to-use-meta-data-to-sort-itself%2f&title=How%20to%20use%20meta-data%20to%20sort%20itself&summary=How%20to%20use%20meta-data%20to%20sort%20itself&source=https%3a%2f%2fwww.xaprb.com%2fblog%2f2006%2f06%2f04%2fhow-to-use-meta-data-to-sort-itself%2f" target="_blank" title="Share on LinkedIn"><i class="fa fa-linkedin-square fa-lg"></i></a>
	<a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.xaprb.com%2fblog%2f2006%2f06%2f04%2fhow-to-use-meta-data-to-sort-itself%2f&t=How%20to%20use%20meta-data%20to%20sort%20itself" target="_blank" title="Share on Facebook"><i class="fa fa-facebook-square fa-lg"></i></a>
	<a href="https://plus.google.com/share?url=https%3a%2f%2fwww.xaprb.com%2fblog%2f2006%2f06%2f04%2fhow-to-use-meta-data-to-sort-itself%2f" target="_blank" title="Share on Google+"><i class="fa fa-google-plus-square fa-lg"></i></a>
</span>

  </span>
  

<p>I&rsquo;m a big fan of meta-data stored in the database. I love having a table that records arbitrary data about data. In fact, such a table can even be used to store meta-data about itself. In this article I&rsquo;ll explain how to use meta-data to define a sort order for both itself and the data to which it&rsquo;s related.</p>

<p>I&rsquo;ve mentioned an online cemetery database several times. One of the great things about this project is it doesn&rsquo;t need custom-designed interfaces for every view on the data; the interfaces can be automatically generated. This was simple until the customer wanted the fields to be ordered a certain way. Since the interfaces are automatically generated from the meta-data, I hadn&rsquo;t built that feature in.</p>

<p>After bit of thought, I found a way to do it easily.</p>

<h3 id="the-setup">The setup</h3>

<p>Here&rsquo;s the table schema for the meta-data:</p>

<pre>create table meta (
   t varchar(50) not null, -- table
   c varchar(50) not null, -- column
   name varchar(50) not null,
   value varchar(50) not null,
   primary key(t, c, name)
)</pre>

<h3 id="defining-a-sort-order">Defining a sort order</h3>

<p>I knew I wanted entries in this table to define a sort order. For the <code>marker</code> table, for instance, I&rsquo;d need entries that looked like this:</p>

<table class="borders collapsed">
  <tr>
    <th scope="col">
      t
    </th>
    
    <th scope="col">
      c
    </th>
    
    <th scope="col">
      name
    </th>
    
    <th scope="col">
      value
    </th>
  </tr>
  
  <tr>
    <td>
      marker
    </td>
    
    <td>
      width
    </td>
    
    <td>
      sort
    </td>
    
    <td>
      1
    </td>
  </tr>
  
  <tr>
    <td>
      marker
    </td>
    
    <td>
      height
    </td>
    
    <td>
      sort
    </td>
    
    <td>
      2
    </td>
  </tr>
  
  <tr>
    <td colspan="4">
      ... etc ...
    </td>
  </tr>
</table>

<p>That data would sort the marker&rsquo;s width first, followed by the height, and so forth.</p>

<p>So far, so good. The only complicating factor was the customer wanted certain fields first, others all the way at the end, and the rest she didn&rsquo;t care about. To ease maintenance, I decided to leave the columns in the middle to fall where they may, so I needed my sorting technique to work correctly when sort order isn&rsquo;t specified.</p>

<p>I decided no table is likely to have more than a couple dozen columns, so I built in a &ldquo;default&rdquo; sort value of 50, and allowed pulling fields to the front with low numbers, or pushing them to the end with high numbers (up to 99). The resulting data looks like this:</p>

<table class="borders collapsed">
  <tr>
    <th scope="col">
      t
    </th>
    
    <th scope="col">
      c
    </th>
    
    <th scope="col">
      name
    </th>
    
    <th scope="col">
      value
    </th>
  </tr>
  
  <tr>
    <td>
      marker
    </td>
    
    <td>
      width
    </td>
    
    <td>
      sort
    </td>
    
    <td>
      1
    </td>
  </tr>
  
  <tr>
    <td>
      marker
    </td>
    
    <td>
      height
    </td>
    
    <td>
      sort
    </td>
    
    <td>
      2
    </td>
  </tr>
  
  <tr>
    <td>
      marker
    </td>
    
    <td>
      notes
    </td>
    
    <td>
      sort
    </td>
    
    <td>
      98
    </td>
  </tr>
  
  <tr>
    <td>
      marker
    </td>
    
    <td>
      misc
    </td>
    
    <td>
      sort
    </td>
    
    <td>
      99
    </td>
  </tr>
</table>

<h3 id="getting-the-data">Getting the data</h3>

<p>I wanted my interface-building query to retrieve all meta-data about the desired table, already sorted in the defined order (I don&rsquo;t like to sort things in code; that&rsquo;s what databases are for). The query to fetch the meta-data <em>without</em> the ordering is pretty simple:</p>

<pre>select m.*
from meta as m
where m.t = 'marker'</pre>

<p>To add the ordering, I have to join the meta table to the &ldquo;sort&rdquo; subset of itself. To make sure all the meta-data is included in the results even if it has no defined sort order, I use a left join. Since there&rsquo;s a left join, the &ldquo;default&rdquo; sort position of 50 is implemented with a <code>COALESCE</code>, and to make string data sort as though it&rsquo;s numeric, I left-padded everything with zeroes to a width of 2 characters:</p>

<pre>select m.*
from meta as m
    left outer join meta as s on m.t = s.t
        and m.c = s.c
        and s.name = 'sort'
where m.t = 'marker'
order by lpad(coalesce(s.value, "50"), 2, "0")</pre>

<p><em>Et voila</em>, meta-data that sorts itself.</p>

  <hr>
  <p><em>I'm Baron Schwartz, the founder and CEO of <a href="https://vividcortex.com/">VividCortex</a>. I am the author of High
  Performance MySQL and lots of open-source software for performance analysis, monitoring, and system administration.
  I contribute to various database communities such as Oracle, PostgreSQL, Redis and MongoDB. <a href="/about/">More about me.</a></em></p>

<div class="pagination">
  
    <a class="pagination-item newer" href="/blog/2006/06/06/what-does-devnull-21-mean/">Newer</a>
  
  
    <a class="pagination-item older" href="/blog/2006/06/02/an-alternative-to-canonical-uris/">Older</a>
  
</div>


  
                          <hr>
                        <h2>Comments</h2>
                        <div id="disqus_thread"></div>
                        <script type="text/javascript">
									var disqus_config = function () {
										this.page.url = 'https:\/\/www.xaprb.com\/blog\/2006\/06\/04\/how-to-use-meta-data-to-sort-itself\/';
									};
                            (function() {
                                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
										  dsq.src = '//xaprb.disqus.com/embed.js';
                                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                            })();
                        </script>

  
</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>


<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v1/st.js','_st');

  _st('install','Dq2t2TnFxXxWs_y9hi1k');
</script>



<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-101883-1', 'auto');
  ga('send', 'pageview');

</script>



  </body>
</html>

